select * from public.customer limit 10;
--Q1. What is the total revenue generated by male vs. female customers?
select 
gender,
sum(purchase_amount) as "Total Revenue"
from public."customer"
group by 1
order by 2 desc;
--Q2. Which customers used a discount but still spent more than the average purchase amount?
SELECT 
"ï»¿customer_id",
SUM("purchase_amount") as total_spent
FROM public.customer
WHERE "discount_applied" = 'Yes'
GROUP BY "ï»¿customer_id"
HAVING SUM("purchase_amount") > (SELECT AVG("purchase_amount") FROM public.customer)
order by 1 asc;
-- Q3. Which are the top 5 products with the highest average review rating?
select
item_purchased,
avg("review_rating") as avg_rating
from public.customer
group by item_purchased
order by 2 desc
limit  5;
--Q4. Compare the average Purchase Amounts between Standard and Express Shipping. 
select
shipping_type,
Round(avg("purchase_amount"),2) as "AVG_Purchase_Amount"
from public.customer
where "shipping_type" IN ('Express', 'Standard')
group by 1;

--Q5. Do subscribed customers spend more? Compare average spend and total revenue 
--between subscribers and non-subscribers.
SELECT
count(ï»¿customer_id) AS "Total_Customers", 
round(avg(purchase_amount),2) AS "Average_Spend",
round(sum(purchase_amount),2)AS "Total_Revenue"   
FROM public."customer"
GROUP BY "subscription_status"
order by 1 desc;

--Q6. Which 5 products have the highest percentage of purchases with discounts applied?
select 
item_purchased,
round(count(case when discount_applied='Yes' Then 1 End)*100/count(*),2) as discount_percentage
from public.customer
group by item_purchased
order by 2 desc limit 5;

--Q7. Segment customers into New, Returning, and Loyal based on their total 
-- number of previous purchases, and show the count of each segment. 
select
case
when "previous_purchases" <= 2 THEN 'New'
when "previous_purchases" BETWEEN 3 AND 10 THEN 'Returning'
else 'Loyal'
end as customer_segment,
count(*) as Number_of_customers
FROM public.customer
GROUP BY 1
ORDER BY total_count DESC;


--Q8. What are the top 3 most purchased products within each category? 
SELECT category, item_purchased, purchase_count
FROM (
SELECT 
category,
item_purchased, 
COUNT(*) AS purchase_count,
DENSE_RANK() OVER (PARTITION BY category ORDER BY COUNT(*) DESC) as rank
FROM public.customer
GROUP BY category, item_purchased
) AS ranked_products
WHERE rank <= 3;


--Q9. Are customers who are repeat buyers (more than 5 previous purchases) also likely to subscribe?
select 
subscription_status,
count("ï»¿customer_id") AS repeat_buyers
FROM customer
WHERE previous_purchases>5
GROUP BY subscription_status;

--Q10. What is the revenue contribution of each age group? 
SELECT 
age_group,
sum(purchase_amount) AS total_revenue
FROM customer
GROUP BY age_group
ORDER BY total_revenue desc;
